<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>몬스터헌터 데이터 시각화</title>
    <style>
        body { 
            font-family: sans-serif; 
            background-color: #333; 
            color: white; 
            padding: 20px; 
            text-align: center;
        }
        #chart { 
            max-width: 1200px; 
            margin: 35px auto; 
        }
    </style>
</head>
<body>

    <h1>몬스터헌터 동시 접속자 수 비교</h1>
    
    <div id="chart"></div>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script>
   // CSV 데이터를 불러와 차트를 그리는 메인 함수
async function drawChart() {
    try {
        // 1. 두 개의 CSV 파일을 동시에 불러오기
        const [worldResponse, wildsResponse] = await Promise.all([
            fetch('data/world_data.csv'),
            fetch('data/wilds_data.csv')
        ]);

        const worldText = await worldResponse.text();
        const wildsText = await wildsResponse.text();

        // 2. CSV 텍스트를 데이터로 변환 (제목 행은 건너뛰기)
        const worldRows = worldText.trim().split('\n').slice(1);
        const wildsRows = wildsText.trim().split('\n').slice(1);
        
        // 3. 차트에 필요한 데이터 형식으로 가공
        const categories = []; // X축 (Day)
        const worldSeriesData = [];  // 월드 데이터 (Y축)
        const wildsDataMap = new Map(); // 와일즈 데이터를 빠르게 찾기 위한 Map

        worldRows.forEach(row => {
            const [day, players] = row.split(',');
            categories.push(day);
            worldSeriesData.push(parseInt(players));
        });

        wildsRows.forEach(row => {
            const [day, players] = row.split(',');
            wildsDataMap.set(day, parseInt(players));
        });

        // 월드 길이에 맞춰 와일즈 데이터를 재구성 (데이터가 없으면 null)
        const wildsSeriesData = categories.map(day => wildsDataMap.get(day) || null);


        // 4. ApexCharts 옵션 설정
        const options = {
            series: [
                { name: 'Monster Hunter: World', data: worldSeriesData },
                { name: 'Monster Hunter: Wilds', data: wildsSeriesData }
            ],
            chart: {
                type: 'area',
                height: 650,
                foreColor: '#ccc',
                toolbar: { show: true }
            },
            title: {
                text: '엇갈린 운명: 몬스터헌터 월드 vs 와일즈',
                align: 'center',
                style: { fontSize: '22px' }
            },
            subtitle: {
                text: '월드 PC 출시: 2018-08-09  |  와일즈 출시: 2025-02-28',
                align: 'center',
                style: { fontSize: '16px', color: '#888' }
            },
            xaxis: {
                categories: categories,
                title: { text: '출시 후 경과일 (Days Since Launch)', style: { fontSize: '14px' } }
            },
            yaxis: {
                title: { text: '최고 동시 접속자 수 (Peak Concurrent Players)', style: { fontSize: '14px' } },
                labels: {
                    formatter: (value) => { return value ? (value / 1000).toFixed(0) + 'K' : '0'; }
                }
            },
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth', width: 2.5 },
            legend: { fontSize: '14px', position: 'top', horizontalAlign: 'left' },
            grid: { borderColor: '#555' },
            colors: ['#3498db', '#2ecc71'],
            // 중요 이벤트 주석(Annotation) 추가
            annotations: {
                points: [
                    { // 와일즈 최고점
                        x: '0',
                        y: wildsSeriesData[0],
                        marker: { size: 6, fillColor: 'white', strokeColor: '#2ecc71', radius: 3 },
                        label: {
                            borderColor: '#2ecc71',
                            offsetY: -15,
                            style: { background: '#2ecc71', color: 'white', padding: { left: 8, right: 8, top: 4, bottom: 4 }},
                            text: 'Wilds 출시 (138만)'
                        }
                    },
                    { // 월드 아이스본 출시
                        x: '518',
                        y: worldSeriesData[categories.indexOf('518')],
                        marker: { size: 6, fillColor: 'white', strokeColor: '#3498db', radius: 3 },
                        label: {
                            borderColor: '#3498db',
                            offsetY: 0,
                            style: { background: '#3498db', color: 'white', padding: { left: 8, right: 8, top: 4, bottom: 4 }},
                            text: 'World 아이스본 출시'
                        }
                    }
                ]
            }
        };

        // 5. 차트 생성 및 렌더링
        const chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();

    } catch (error) {
        console.error("차트를 그리는데 실패했습니다:", error);
        document.querySelector("#chart").innerHTML = "<h2>차트를 불러오는 데 실패했습니다. CSV 파일 경로와 형식을 확인해주세요.</h2>";
    }
}

// 메인 함수 실행
drawChart();
    </script>

</body>
</html>
